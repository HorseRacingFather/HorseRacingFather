# HorseRacingFather

今週の競馬のレース予定を取得し、簡易な予想スコアを付与して表示する静的Webサイト。GitHub Pagesでホスティングし、GitHub Actionsでビルド/デプロイおよび金曜夜(JST)の定期取得を自動化する。

## 目的 / スコープ
- 今週末の主要レース（重賞含む）の一覧と各レースの出走馬に対する「仮予想スコア」を表示する
- ソート切り替え（馬番順 / 予想順 / 人気順）に対応する
- まずは簡易な「適当」ロジックの予想でOK（将来差し替え可能な構造にする）
- モバイル/PCのレスポンシブ対応、モダンなUIスタイル
- データは定期的にWebから取得し、静的JSONとして保存→サイトで読み込み

## データソース
- netkeiba レースカレンダーのみ: [https://race.netkeiba.com/top/calendar.html](https://race.netkeiba.com/top/calendar.html)
  - 例: 各日付のリンク先 `.../race_list.html?kaisai_date=YYYYMMDD` → 出馬表 `race/shutuba.html?race_id=...`

## データ取得要件（スクレイピング/収集）
- スケジュール: 毎週金曜 夜（JST）に自動実行
  - GitHub ActionsのcronはUTC基準のため、例: 金曜 21:00 JST = 金曜 12:00 UTC → `0 12 * * FRI`
- 取得対象範囲
  - 直近の週末（今週土日および祝日開催があれば含む）の開催
  - レース基本情報（開催日、場、グレード、レース名、距離、馬場など）
  - 出走予定馬の一覧（馬番、馬名、性齢、騎手、斤量、（可能なら）オッズ/人気）
- 実装方針
  - カレンダー → 日別レース一覧 → 各レース詳細（必要に応じて）をたどる
  - 取得したデータはJSONファイルとして `data/` 配下に保存し、コミット（後述のワークフローで自動）
- リトライ/失敗時
  - 3回まで指数バックオフで再試行
  - 完全失敗時は前回データを温存。ワークフローで失敗を通知（通知先はGitHub ActionsのUI/メール）
- 倫理・注意
  - 各サイトの利用規約/robotsに配慮し、必要最小限の情報のみ取得
  - 過度な高頻度アクセスを回避（User-Agent明示、アクセス間隔スリープ）

## 予想ロジック（初期実装）
- 当面は「適当」でOK（ダミー予想）
  - 例: 馬ごとに乱数ベースのスコアを付与（レースID+馬IDを種にして再現性確保）
  - 将来: 過去成績/ラップ/騎手成績などに差し替え可能なプラグイン構造
- 人気順について
  - 取得できる場合はオッズ/人気を反映
  - 取得不可時は `popularity` を `null` とし、UIでは「未取得」を明示

## 表示要件 / UI
- トップ: 「今週の開催」一覧（場ごと/日付ごと）
- レース詳細: 出走馬テーブル/カード表示、以下の並び替え切替
  - 馬番順 / 予想スコア順 / 人気順
- フィルタ/並べ替え
  - 開催日、競馬場、重賞（G1/G2/G3）、距離など（段階的に）
- スタイル
  - モダン（余白、タイポグラフィ、カード、柔らかいシャドウ、アクセシビリティ配慮）
  - ライト/ダーク両対応（システム設定に追従）
- レスポンシブ
  - スマホ: 1カラム中心、重要情報を上位に
  - PC: 2〜3カラムやテーブル視認性を最適化

## 技術スタック（提案）
- フロント: TypeScript + React + Vite（静的サイトビルド）
- スタイル: Tailwind CSS（またはCSS Modules / vanilla-extract）
- データ: `data/` 配下の静的JSONをフロントでフェッチして描画
- ホスティング: GitHub Pages（`gh-pages` ブランチに出力を配信）
- 自動化: GitHub Actions（ビルド/デプロイ、定期取得ジョブ）

## データモデル（JSON例）
```json
{
  "generatedAt": "2025-09-12T12:00:00Z",
  "week": "2025-09-13",
  "races": [
    {
      "raceId": "202509130811", // 例: YYYYMMDD + 開催場 + R番号
      "date": "2025-09-13",
      "course": "中山",
      "grade": "G2",
      "name": "セントライト記念",
      "distance": 2200,
      "surface": "芝",
      "turn": "右",
      "entries": [
        {
          "horseId": "h_12345",
          "horseNumber": 1,
          "name": "サンプルホース",
          "sexAge": "牡3",
          "jockey": "○○騎手",
          "weight": 56,
          "odds": 4.8,
          "popularity": 2,
          "predictionScore": 0.71,
          "predictionRank": 3
        }
      ]
    }
  ]
}
```

### ディレクトリ/ファイル設計
- `src/` フロントエンド実装（ページ、コンポーネント）
- `scripts/` 収集/整形スクリプト（Node.js/TypeScript）
- `data/` 生成データ
  - `data/YYYY/YYYMMDD.json`（週単位、または日付/場ごとに分割も可）
- `public/` アイコン、OGP等

## 並び替え仕様
- 馬番順: `entries` を `horseNumber` 昇順
- 予想順: `predictionScore` 降順（同点は `horseNumber`）
- 人気順: `popularity` 昇順（`null` は末尾）

## ビルド/デプロイ（GitHub Pages）
- `main` ブランチにpush → CIでビルド → `gh-pages` ブランチへ静的ファイルをデプロイ
- 推奨アクション
  - `actions/checkout@v4`
  - `actions/setup-node@v4`
  - `pnpm` or `npm ci`
  - ビルド: `vite build`
  - デプロイ: `peaceiris/actions-gh-pages@v3`（`publish_dir: dist`）

## 定期取得ワークフロー（GitHub Actions）
- トリガー
  - `schedule: cron: "0 12 * * FRI"`（毎週金曜 21:00 JST）
  - `workflow_dispatch`（手動実行）
- 処理概要
  1) 収集スクリプトを実行して `data/` を更新
  2) 変更があればコミット/プッシュ（`main`）
  3) 上記でCIが走り自動デプロイ
- 実装メモ
  - Botコミット用のユーザー/メール設定
  - 収集時のUser-Agent設定、各リクエスト間に `sleep(500-1000ms)`

## アクセシビリティ / 品質
- キーボード操作、コントラスト比、ARIA属性
- 画像代替テキスト、フォーカスリング
- LightHouse目安: Performance 90+/Accessibility 90+

## 非機能要件
- 可用性: 静的配信のため高、依存はGitHub Pages
- 監視: Actionsの結果（バッジ表示）、失敗時は再実行
- ログ/トレース: 収集ログをActionsのArtifactsへ保存（必要に応じて）

## リスク/制約
- スクレイピング先の構造変更/アクセス制御で取得失敗の可能性
- オッズ/人気はタイミングにより未確定/非公開の場合がある
- 著作権/利用規約に抵触しない範囲で最小限のメタデータのみ使用

## 将来拡張
- 予想モデルの高度化（機械学習、特徴量設計）
- キャッシュ/差分更新最適化、複数データソース統合
- PWA対応、通知機能（レース直前アラート）
- 多言語化

## 参考リンク
- netkeiba レースカレンダー: [https://race.netkeiba.com/top/calendar.html](https://race.netkeiba.com/top/calendar.html)
